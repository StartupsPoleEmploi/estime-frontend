<app-fil-etapes-desktop *ngIf="!screenService.isExtraSmallScreen()"></app-fil-etapes-desktop>
<app-fil-etapes-mobile *ngIf="screenService.isExtraSmallScreen()"></app-fil-etapes-mobile>
<div class="container-fluid form-container-fluid" role="form">
    <div class="row">
        <div class="col">
            <h1 class="h1-style-1 headline-1-typo">
                5. {{pageTitlesEnum.RESULTAT_MA_SIMULATION}}
                <button id="infobulle-resultat-simulation" class="img-interrogation-icon"
                    aria-label="Infobulle évolution de résultat" style="vertical-align: baseline;" placement="right top"
                    tag-action="ouverture-infobulle-resultat-simulation"
                    (click)="modalService.openModal($event, modalResultatSimulationTemplate)"></button>
            </h1>
        </div>
    </div>
    <div class="row row-style-2">
        <div id="alert-resultat-simulation" class="col-12 col-md-12 mt-auto mb-auto">
            <div id="label-alerte-montants-resultat-simulation" class="mx-2 text-justify body-2-typo">
                Votre éventuel prélèvement de l’impôt à la source n’est pas pris en compte dans le résultat.
            </div>
            <div id="label-alerte-declaration-caf" class="mx-2 text-justify body-2-typo">
                Si vous êtes allocataire, vous devez déclarer immédiatement toute nouvelle activité professionnelle
                auprès de la CAF pour recalculer vos droits.
            </div>
        </div>
    </div>
    <div class="row row-telecharger-ou-refaire row-style-2">
        <div class="col-12 col-md-6 my-auto">
            <span id="btn-telecharger-simulation" class="btn-telecharger-ou-refaire"
                data-testid="btn-telecharger-simulation" tabindex="0" (click)="onClickButtonImprimerMaSimulation()"
                (keyup)="handleKeyUpOnTelechargerSimulation($event)"
                tag-download="clic_bouton_telecharger_ma_simulation">
                <div>
                    <img alt="" src="./assets/images/download_2.svg">
                    <span id="telecharger_simulation_text" class="button-typo">Télécharger la simulation</span>
                </div>
            </span>
        </div>
        <div *ngIf="this.screenService.isExtraSmallScreen()" style="margin-bottom: 2vh;"></div>
        <div class="col-12 col-md-6 my-auto">
            <span id="btn-refaire-simulation" class="btn-telecharger-ou-refaire" data-testid="btn-refaire-simulation"
                tabindex="0" (click)="onClickButtonRefaireSimulation()" (keyup)="handleKeyUpOnRefaireSimulation($event)"
                tag-navigation="clic_bouton_retour">
                <div>
                    <img alt="" src="./assets/images/refaire_simulation.svg">
                    <span id="refaire_simulation_text" class="button-typo">Refaire une simulation</span>
                </div>
            </span>
        </div>
    </div>
    <div id="row-onglets-resultat-simulation" class="row">
        <div id="col-onglet-1-resultat-simulation" class="col-6">
            <button id="btn-onglet-details" class="btn btn-onglet-resultat-simulation" (click)="onClickOnglet(true)"
                tabindex="0" [ngClass]="{isOngletInactive: !afficherDetails}">
                <span class="button-typo">
                    Détail <span *ngIf="!screenService.isExtraSmallScreen()" class="button-typo">des ressources
                        estimées</span>
                </span>
            </button>
        </div>
        <div id="col-onglet-2-resultat-simulation" class="col-6">
            <button id="btn-onglet-evolution" class="btn btn-onglet-resultat-simulation" (click)="onClickOnglet(false)"
                tabindex="0" [ngClass]="{isOngletInactive: afficherDetails}">
                <span class="button-typo">
                    Évolution <span *ngIf="!screenService.isExtraSmallScreen()" class="button-typo">des ressources sur
                        {{ nombreMoisSimules }} mois</span>
                </span>
            </button>
        </div>
    </div>
    <div *ngIf="afficherDetails" class="mt-5">
        <div id="title_avant_simulation">
            <h3 class="headline-3-typo color-blue-2-typo text-start">Avant reprise d'emploi</h3>
        </div>
        <div id="card_ressources_avant_simulation" class="card row mb-3">
            <div class="col-12 col-md-12">
                <h4 id="mois_ressources_avant_simulation" class="headline-4-typo color-blue-2-typo text-start">
                    {{ dateUtileService.getLibelleDateActuelle() }}
                </h4>
                <h5 id="montant_ressources_avant_simulation" class="headline-5-typo color-blue-10-typo text-start"
                    data-testid="montant_ressources_actuelles">
                    {{simulation.montantRessourcesFinancieresMoisAvantSimulation}} € net
                </h5>
            </div>
        </div>
        <div id="title_apres_simulation">
            <h3 class="headline-3-typo color-blue-2-typo text-start">Après reprise d'emploi</h3>
        </div>
        <div class="ressources_avant_simulation">
            <div class="card_ressources_apres_simulation card row mb-3"
                [ngClass]="{'card-simulations-mobile': screenService.isExtraSmallScreen(), 'card-simulations-desktop': !screenService.isExtraSmallScreen()}"
                *ngFor="let simulationMensuelle of simulation.simulationsMensuelles; let index = index;" tabindex="0"
                (keyup)="handleKeyUpOnSimulationMensuelle($event,simulationMensuelle);">
                <div class="col-md-12 col-12">
                    <app-mois-apres-simulation [simulationSelected]="simulationSelected"
                        [simulationActuelle]="simulationMensuelle" (simulationSelection)="simulationSelection($event)">
                    </app-mois-apres-simulation>
                </div>
            </div>
        </div>
    </div>
    <div *ngIf="!afficherDetails" class="row row-style-3">
        <div class="col-12">
            <app-ressources-financieres-diagramme [simulation]="simulation">
            </app-ressources-financieres-diagramme>
            <app-message-info *ngIf="aidesService.getMessageAlerteAidesFamilialesNoSelect(simulation)" [contenu]="
                aidesService.getMessageAlerteAidesFamilialesNoSelect(simulation)">
            </app-message-info>
        </div>
    </div>
    <div id="actions-suite">
        <app-actions-suite>
        </app-actions-suite>
    </div>
</div>

<ng-template #modalResultatSimulationTemplate>
    <app-tooltip [modalRef]="modalService.modalRef" htmlData="
        <p class='body-2-typo'>
            Pour information, si votre situation change et que vous reprenez un emploi, vos allocations sont
            susceptibles d'évoluer.
        </p>">
    </app-tooltip>
</ng-template>

<ng-template #modalDetailMoisApresSimulation>
    <app-detail-mois-apres-simulation *ngIf="simulationSelected" [simulationActuelle]="simulationSelected"
        (aideSelection)="aideSelection($event)">
    </app-detail-mois-apres-simulation>
</ng-template>

<ng-template #modalDetailAideApresSimulation>
    <app-detail-aide-apres-simulation *ngIf="aideSelected" [aide]="aideSelected">
    </app-detail-aide-apres-simulation>
</ng-template>