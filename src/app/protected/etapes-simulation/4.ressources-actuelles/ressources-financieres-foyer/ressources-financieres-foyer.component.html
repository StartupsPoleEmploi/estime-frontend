<div class="card card-body card-form">
    <form
        (ngSubmit)="onSubmitRessourcesFinancieresFoyerForm(ressourcesFinancieresFoyerForm)"
        [ngClass]="{'submitted':isRessourcesFinancieresFoyerFormSubmitted}"
        #ressourcesFinancieresFoyerForm="ngForm">
        <div class="form-group">
            <div class="row mb-2">
                <label
                    class="label"
                    for="montantAllocationsLogement">
                    * Allocations logement perçues pour les 3 derniers mois
                </label>
            </div>
            <div class="mb-2">
                <div
                    class="row"
                    *ngIf="screenService.isExtraSmallScreen()">
                    <span class="text-side-input ml-0">
                        au mois de {{this.dateUtileService.getDateFormateeAvantDateJour(1)}}
                    </span>
                </div>
                <div class="row">
                    <input
                        attr.aria-label="Allocations logement perçue au mois de {{this.dateUtileService.getDateFormateeAvantDateJour(1)}}"
                        name="allocationsLogementMoisNMoins1"
                        pattern="{{controleChampFormulaireService.REGEX_DECIMAL}}"
                        data-testid="input-apl-mois-moins-1"
                        (keypress)="controleChampFormulaireService.isKeyAuthorizeForDecimal($event)"
                        type="text"
                        min="0"
                        maxlength="6"
                        class="max-with-input-type-montant form-control"
                        placeholder="Montant"
                        [(ngModel)]="ressourcesFinancieres.aidesCAF.allocationsLogement.moisNMoins1"
                        inputmode="decimal"
                        (click)="$event.target.select()"
                        #allocationsLogementMoisNMoins1="ngModel">
                    <app-text-with-euro-symbol *ngIf="screenService.isExtraSmallScreen()"></app-text-with-euro-symbol>
                    <app-text-with-euro-symbol
                        *ngIf="!screenService.isExtraSmallScreen()"
                        [message]="'au mois de '  + this.dateUtileService.getDateFormateeAvantDateJour(1)">
                    </app-text-with-euro-symbol>
                </div>
                <div class="row">
                    <span
                        class="error-input-message"
                        *ngIf="(isRessourcesFinancieresFoyerFormSubmitted || allocationsLogementMoisNMoins1?.touched)  && allocationsLogementMoisNMoins1?.errors?.required">
                        {{controleChampFormulaireService.MESSAGE_CHAMP_OBLIGATOIRE}}
                    </span>
                    <span
                        class="error-input-message"
                        *ngIf="(isRessourcesFinancieresFoyerFormSubmitted || allocationsLogementMoisNMoins1.touched)  && allocationsLogementMoisNMoins1.errors?.pattern">
                        {{controleChampFormulaireService.MESSAGE_MONTANT_ERREUR}}
                    </span>
                </div>
            </div>
            <div class="mb-2">
                <div
                    class="row"
                    *ngIf="screenService.isExtraSmallScreen()">
                    <span class="text-side-input ml-0">
                        au mois de {{this.dateUtileService.getDateFormateeAvantDateJour(2)}}
                    </span>
                </div>
                <div class="row">
                    <input
                        attr.aria-label="Allocations logement perçue au mois de {{this.dateUtileService.getDateFormateeAvantDateJour(2)}}"
                        name="allocationsLogementMoisNMoins2"
                        pattern="{{controleChampFormulaireService.REGEX_DECIMAL}}"
                        data-testid="input-apl-mois-moins-2"
                        (keypress)="controleChampFormulaireService.isKeyAuthorizeForDecimal($event)"
                        type="text"
                        min="0"
                        maxlength="6"
                        class="max-with-input-type-montant form-control"
                        placeholder="Montant"
                        [(ngModel)]="ressourcesFinancieres.aidesCAF.allocationsLogement.moisNMoins2"
                        inputmode="decimal"
                        required
                        (click)="$event.target.select()"
                        #allocationsLogementMoisNMoins2="ngModel">
                    <app-text-with-euro-symbol *ngIf="screenService.isExtraSmallScreen()"></app-text-with-euro-symbol>
                    <app-text-with-euro-symbol
                        *ngIf="!screenService.isExtraSmallScreen()"
                        [message]="'au mois de ' + this.dateUtileService.getDateFormateeAvantDateJour(2)">
                    </app-text-with-euro-symbol>
                </div>
                <div class="row">
                    <span
                        class="error-input-message"
                        *ngIf="(isRessourcesFinancieresFoyerFormSubmitted || allocationsLogementMoisNMoins2?.touched)  && allocationsLogementMoisNMoins2?.errors?.required">
                        {{controleChampFormulaireService.MESSAGE_CHAMP_OBLIGATOIRE}}
                    </span>
                    <span
                        class="error-input-message"
                        *ngIf="(isRessourcesFinancieresFoyerFormSubmitted || allocationsLogementMoisNMoins2.touched)  && allocationsLogementMoisNMoins2.errors?.pattern">
                        {{controleChampFormulaireService.MESSAGE_MONTANT_ERREUR}}
                    </span>
                </div>
            </div>
            <div class="mb-2">
                <div
                    class="row"
                    *ngIf="screenService.isExtraSmallScreen()">
                    <span class="text-side-input ml-0">
                        au mois de {{this.dateUtileService.getDateFormateeAvantDateJour(3)}}
                    </span>
                </div>
                <div class="row">
                    <input
                        attr.aria-label="Allocations logement perçue au mois de {{this.dateUtileService.getDateFormateeAvantDateJour(3)}}"
                        name="allocationsLogementMoisNMoins3"
                        pattern="{{controleChampFormulaireService.REGEX_DECIMAL}}"
                        data-testid="input-apl-mois-moins-3"
                        (keypress)="controleChampFormulaireService.isKeyAuthorizeForDecimal($event)"
                        type="text"
                        min="0"
                        maxlength="6"
                        class="max-with-input-type-montant form-control"
                        placeholder="Montant"
                        [(ngModel)]="ressourcesFinancieres.aidesCAF.allocationsLogement.moisNMoins3"
                        inputmode="decimal"
                        required
                        (click)="$event.target.select()"
                        #allocationsLogementMoisNMoins3="ngModel">
                    <app-text-with-euro-symbol *ngIf="screenService.isExtraSmallScreen()"></app-text-with-euro-symbol>
                    <app-text-with-euro-symbol
                        *ngIf="!screenService.isExtraSmallScreen()"
                        [message]="'au mois de ' + this.dateUtileService.getDateFormateeAvantDateJour(3)">
                    </app-text-with-euro-symbol>
                </div>
                <div class="row">
                    <span
                        class="error-input-message"
                        *ngIf="(isRessourcesFinancieresFoyerFormSubmitted || allocationsLogementMoisNMoins3?.touched)  && allocationsLogementMoisNMoins3?.errors?.required">
                        {{controleChampFormulaireService.MESSAGE_CHAMP_OBLIGATOIRE}}
                    </span>
                    <span
                        class="error-input-message"
                        *ngIf="(isRessourcesFinancieresFoyerFormSubmitted || allocationsLogementMoisNMoins3.touched)  && allocationsLogementMoisNMoins3.errors?.pattern">
                        {{controleChampFormulaireService.MESSAGE_MONTANT_ERREUR}}
                    </span>
                </div>
            </div>
        </div>
        <div
            class="form-group"
            *ngIf="deConnecteSituationFamilialeService.hasPersonneAChargeSuperieur(1)">
            <div class="row mb-2">
                <label
                    class="label"
                    for="allocationsFamiliales">
                    * Allocations familiales
                </label>
            </div>
            <div
                class="row"
                *ngIf="screenService.isExtraSmallScreen()">
                <span class="text-side-input ml-0">le mois dernier</span>
            </div>
            <div class="row">
                <input
                    attr.aria-label="Allocations familiales du mois dernier"
                    name="allocationsFamiliales"
                    data-testid="input-af"
                    pattern="{{controleChampFormulaireService.REGEX_DECIMAL}}"
                    (keypress)="controleChampFormulaireService.isKeyAuthorizeForDecimal($event)"
                    type="text"
                    min="0"
                    maxlength="6"
                    class="max-with-input-type-montant form-control"
                    placeholder="Montant"
                    [(ngModel)]="ressourcesFinancieres.aidesCAF.aidesFamiliales.allocationsFamiliales"
                    inputmode="decimal"
                    required
                    (click)="$event.target.select()"
                    #allocationsFamiliales="ngModel">
                <app-text-with-euro-symbol *ngIf="screenService.isExtraSmallScreen()"></app-text-with-euro-symbol>
                <app-text-with-euro-symbol
                    *ngIf="!screenService.isExtraSmallScreen()"
                    message="le mois dernier"></app-text-with-euro-symbol>
            </div>
            <div class="row">
                <span
                    class="error-input-message"
                    *ngIf="(isRessourcesFinancieresFoyerFormSubmitted || allocationsFamiliales?.touched)  && allocationsFamiliales?.errors?.required">
                    {{controleChampFormulaireService.MESSAGE_CHAMP_OBLIGATOIRE}}
                </span>
                <span
                    class="error-input-message"
                    *ngIf="(isRessourcesFinancieresFoyerFormSubmitted || allocationsFamiliales.touched)  && allocationsFamiliales.errors?.pattern">
                    {{controleChampFormulaireService.MESSAGE_MONTANT_ERREUR}}
                </span>
            </div>
        </div>
        <div
            class="form-group"
            *ngIf="deConnecteSituationFamilialeService.hasPersonneAChargeSuperieur(0)">
            <div class="row mb-2">
                <label
                    class="label"
                    for="allocationSoutienFamilial">
                    * Allocation soutien familial
                </label>
            </div>
            <div
                class="row"
                *ngIf="screenService.isExtraSmallScreen()">
                <span class="text-side-input ml-0">le mois dernier</span>
            </div>
            <div class="row">
                <input
                    attr.aria-label="Allocation de soutien familiale du mois dernier"
                    name="allocationSoutienFamilial"
                    data-testid="input-asf"
                    pattern="{{controleChampFormulaireService.REGEX_DECIMAL}}"
                    (keypress)="controleChampFormulaireService.isKeyAuthorizeForDecimal($event)"
                    type="text"
                    min="0"
                    maxlength="6"
                    class="max-with-input-type-montant form-control"
                    placeholder="Montant"
                    [(ngModel)]="ressourcesFinancieres.aidesCAF.aidesFamiliales.allocationSoutienFamilial"
                    inputmode="decimal"
                    required
                    (click)="$event.target.select()"
                    #allocationSoutienFamilial="ngModel">
                <app-text-with-euro-symbol *ngIf="screenService.isExtraSmallScreen()"></app-text-with-euro-symbol>
                <app-text-with-euro-symbol
                    *ngIf="!screenService.isExtraSmallScreen()"
                    message="le mois dernier"></app-text-with-euro-symbol>
            </div>
            <div class="row">
                <span
                    class="error-input-message"
                    *ngIf="(isRessourcesFinancieresFoyerFormSubmitted || allocationSoutienFamilial?.touched)  && allocationSoutienFamilial?.errors?.required">
                    {{controleChampFormulaireService.MESSAGE_CHAMP_OBLIGATOIRE}}
                </span>
                <span
                    class="error-input-message"
                    *ngIf="(isRessourcesFinancieresFoyerFormSubmitted || allocationSoutienFamilial.touched)  && allocationSoutienFamilial.errors?.pattern">
                    {{controleChampFormulaireService.MESSAGE_MONTANT_ERREUR}}
                </span>
            </div>
        </div>
        <div
            class="form-group"
            *ngIf="deConnecteSituationFamilialeService.hasPersonneAChargeSuperieur(0)">
            <div class="row mb-2">
                <label
                    class="label"
                    for="allocationsFamiliales">
                    * Complément familial
                </label>
            </div>
            <div class="row" *ngIf="screenService.isExtraSmallScreen()">
              <span
                    class="text-side-input ml-0">
                    le mois dernier
                </span>
            </div>
            <div class="row">
                <input
                    attr.aria-label="Complément familial du mois dernier"
                    name="complementFamilial"
                    data-testid="input-cf"
                    pattern="{{controleChampFormulaireService.REGEX_DECIMAL}}"
                    (keypress)="controleChampFormulaireService.isKeyAuthorizeForDecimal($event)"
                    type="text"
                    min="0"
                    maxlength="6"
                    class="max-with-input-type-montant form-control"
                    placeholder="Montant"
                    [(ngModel)]="ressourcesFinancieres.aidesCAF.aidesFamiliales.complementFamilial"
                    inputmode="decimal"
                    required
                    (click)="$event.target.select()"
                    #complementFamilial="ngModel">
                <app-text-with-euro-symbol *ngIf="screenService.isExtraSmallScreen()"></app-text-with-euro-symbol>
                <app-text-with-euro-symbol
                    *ngIf="!screenService.isExtraSmallScreen()"
                    message="le mois dernier"></app-text-with-euro-symbol>
            </div>
            <div class="row">
                <span
                    class="error-input-message"
                    *ngIf="(isRessourcesFinancieresFoyerFormSubmitted || complementFamilial?.touched)  && complementFamilial?.errors?.required">
                    {{controleChampFormulaireService.MESSAGE_CHAMP_OBLIGATOIRE}}
                </span>
                <span
                    class="error-input-message"
                    *ngIf="(isRessourcesFinancieresFoyerFormSubmitted || complementFamilial.touched)  && complementFamilial.errors?.pattern">
                    {{controleChampFormulaireService.MESSAGE_MONTANT_ERREUR}}
                </span>
            </div>
        </div>
        <div
            class="form-group"
            *ngIf="deConnecteSituationFamilialeService.hasPersonneAChargeMoinsDe3Ans();">
            <div class="row mb-2">
                <label
                    class="label"
                    for="montantPAJEFoyer">
                    * PAJE (prestation d'accueil du jeune enfant)
                </label>
            </div>
            <div class="row" *ngIf="screenService.isExtraSmallScreen()">
              <span
                    class="text-side-input ml-0">
                    le mois dernier
                </span>
            </div>
            <div class="row">
                <input
                    id="montantPAJEFoyer"
                    name="montantPAJEFoyer"
                    data-testid="input-prestation-accueil-jeune-enfant"
                    pattern="{{controleChampFormulaireService.REGEX_DECIMAL}}"
                    (keypress)="controleChampFormulaireService.isKeyAuthorizeForDecimal($event)"
                    type="text"
                    min="0"
                    maxlength="6"
                    class="max-with-input-type-montant form-control"
                    placeholder="Montant"
                    [(ngModel)]="ressourcesFinancieres.aidesCAF.aidesFamiliales.prestationAccueilJeuneEnfant"
                    inputmode="decimal"
                    required
                    (click)="$event.target.select()"
                    #prestationAccueilJeuneEnfantFoyer="ngModel">
                <app-text-with-euro-symbol *ngIf="screenService.isExtraSmallScreen()"></app-text-with-euro-symbol>
                <app-text-with-euro-symbol
                    *ngIf="!screenService.isExtraSmallScreen()"
                    message="le mois dernier"></app-text-with-euro-symbol>
            </div>
            <div class="row">
                <span
                    class="error-input-message"
                    *ngIf="(isRessourcesFinancieresFoyerFormSubmitted || prestationAccueilJeuneEnfantFoyer?.touched)  && prestationAccueilJeuneEnfantFoyer?.errors?.required">
                    {{controleChampFormulaireService.MESSAGE_CHAMP_OBLIGATOIRE}}
                </span>
                <span
                    class="error-input-message"
                    *ngIf="(isRessourcesFinancieresFoyerFormSubmitted || prestationAccueilJeuneEnfantFoyer.touched)  && prestationAccueilJeuneEnfantFoyer.errors?.pattern">
                    {{controleChampFormulaireService.MESSAGE_MONTANT_ERREUR}}
                </span>
            </div>
        </div>
        <div
            class="form-group"
            *ngIf="deConnecteSituationFamilialeService.hasPersonneAChargeSuperieur(0)">
            <div class="row mb-2">
                <label
                    class="label"
                    for="montantPersionsAlimentairesFoyer">
                    * Pensions alimentaires du foyer perçues
                </label>
            </div>
            <div class="row" *ngIf="screenService.isExtraSmallScreen()">
                    <span class="text-side-input ml-0">le mois dernier</span>
            </div>
            <div class="row">
                <input
                    id="montantPersionsAlimentairesFoyer"
                    name="montantPersionsAlimentairesFoyer"
                    pattern="{{controleChampFormulaireService.REGEX_DECIMAL}}"
                    (keypress)="controleChampFormulaireService.isKeyAuthorizeForDecimal($event)"
                    type="text"
                    min="0"
                    maxlength="6"
                    class="max-with-input-type-montant form-control"
                    placeholder="Montant"
                    [(ngModel)]="ressourcesFinancieres.aidesCAF.aidesFamiliales.pensionsAlimentairesFoyer"
                    inputmode="decimal"
                    required
                    (click)="$event.target.select()"
                    #pensionsAlimentairesFoyer="ngModel">
                <app-text-with-euro-symbol *ngIf="screenService.isExtraSmallScreen()"></app-text-with-euro-symbol>
                <app-text-with-euro-symbol
                    *ngIf="!screenService.isExtraSmallScreen()"
                    message="le mois dernier"></app-text-with-euro-symbol>
            </div>
            <div class="row">
                <span
                    class="error-input-message"
                    *ngIf="(isRessourcesFinancieresFoyerFormSubmitted || pensionsAlimentairesFoyer?.touched)  && pensionsAlimentairesFoyer?.errors?.required">
                    {{controleChampFormulaireService.MESSAGE_CHAMP_OBLIGATOIRE}}
                </span>
                <span
                    class="error-input-message"
                    *ngIf="(isRessourcesFinancieresFoyerFormSubmitted || pensionsAlimentairesFoyer.touched)  && pensionsAlimentairesFoyer.errors?.pattern">
                    {{controleChampFormulaireService.MESSAGE_MONTANT_ERREUR}}
                </span>
            </div>
        </div>

        <div
            class="form-group"
            *ngIf="deConnecteInfosPersonnellesService.hasRevenusImmobilier()">
            <div class="row mb-2">
                <label
                    class="label"
                    for="revenusImmobilierFoyer">
                    * Revenus annuels de placement ou du patrimoine
                    <div
                        id="infobulle-revenus-immobilier"
                        role="tooltip"
                        class="img-interrogation-icon"
                        [ngClass]="{'popover-open': popoverRevenusImmobiliers.isOpen}"
                        placement="right"
                        tag-action="ouverture-infobulle-revenus-immobilier"
                        [popover]="popoverRevenusImmobiliersTemplate"
                        #popoverRevenusImmobiliers="bs-popover"></div>
                </label>
            </div>
            <div class="row" *ngIf="screenService.isExtraSmallScreen()">
                <span
                    class="text-side-input ml-0">
                    net total 3 derniers mois
                </span>
            </div>
            <div class="row">
                <input
                    id="revenusImmobilierFoyer"
                    name="revenusImmobilier"
                    pattern="{{controleChampFormulaireService.REGEX_DECIMAL}}"
                    (keypress)="controleChampFormulaireService.isKeyAuthorizeForDecimal($event)"
                    type="text"
                    maxlength="6"
                    min="0"
                    class="max-with-input-type-montant form-control"
                    placeholder="Montant"
                    [(ngModel)]="ressourcesFinancieres.revenusImmobilier3DerniersMois"
                    [ngClass]="{'ng-invalid': this.ressourcesFinancieres.revenusImmobilier3DerniersMois && (this.ressourcesFinancieres.revenusImmobilier3DerniersMois == 0)}"
                    required
                    inputmode="decimal"
                    #revenusImmobilier="ngModel">
                <app-text-with-euro-symbol *ngIf="screenService.isExtraSmallScreen()"></app-text-with-euro-symbol>
                <app-text-with-euro-symbol
                    *ngIf="!screenService.isExtraSmallScreen()"
                    message="net total 3 derniers mois">
                </app-text-with-euro-symbol>
            </div>
            <div class="row">
                <span
                    class="error-input-message"
                    *ngIf="(isRessourcesFinancieresFoyerFormSubmitted || revenusImmobilier?.touched)  && revenusImmobilier?.errors?.required">
                    {{controleChampFormulaireService.MESSAGE_CHAMP_OBLIGATOIRE}}
                </span>
                <span
                    class="error-input-message"
                    *ngIf="(isRessourcesFinancieresFoyerFormSubmitted || revenusImmobilier?.touched)  && revenusImmobilier?.errors?.pattern">
                    {{controleChampFormulaireService.MESSAGE_MONTANT_ERREUR}}
                </span>
                <span
                    *ngIf="this.ressourcesFinancieres.revenusImmobilier3DerniersMois && (this.ressourcesFinancieres.revenusImmobilier3DerniersMois == 0)"
                    class="error-input-message">
                    {{controleChampFormulaireService.MESSAGE_MONTANT_0}}
                </span>
            </div>
        </div>
        <div class="row row-button-valider">
            <button
                id="btn-ressources-foyer-valider"
                aria-label="Valider ressources finançière de votre foyer"
                class="btn-style-perso-3"
                type="submit"
                data-testid="btn-ressources-foyer-valider">
                <div>
                    <span>Valider</span>
                </div>
            </button>
        </div>
    </form>
</div>
